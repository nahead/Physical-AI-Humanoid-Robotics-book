"use strict";(globalThis.webpackChunkdocusaurus=globalThis.webpackChunkdocusaurus||[]).push([[897],{3119:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>t,contentTitle:()=>c,default:()=>h,frontMatter:()=>l,metadata:()=>r,toc:()=>d});const r=JSON.parse('{"id":"module1-ros/nodes-topics-services","title":"ROS 2 Nodes, Topics, and Services","description":"In ROS 2, the communication system is built around a decentralized architecture where individual processes, called nodes, interact with each other through various communication patterns. This modularity is a cornerstone of ROS, allowing for flexible and robust robot software development. This chapter will delve into the core communication mechanisms: Topics, Services, and Actions.","source":"@site/docs/module1-ros/02-nodes-topics-services.md","sourceDirName":"module1-ros","slug":"/module1-ros/nodes-topics-services","permalink":"/docs/module1-ros/nodes-topics-services","draft":false,"unlisted":false,"editUrl":"https://github.com/nahead/Physical-AI-Humanoid-Robotics-book/tree/main/docs/module1-ros/02-nodes-topics-services.md","tags":[],"version":"current","sidebarPosition":2,"frontMatter":{},"sidebar":"bookSidebar","previous":{"title":"Module 1: ROS 2","permalink":"/docs/category/module-1-ros-2"},"next":{"title":"Bridging Python Agents to ROS Controllers using rclpy","permalink":"/docs/module1-ros/python-rclpy-bridge"}}');var i=s(4848),o=s(8453);const l={},c="ROS 2 Nodes, Topics, and Services",t={},d=[{value:"Concepts",id:"concepts",level:2},{value:"Nodes",id:"nodes",level:3},{value:"Topics",id:"topics",level:3},{value:"Services",id:"services",level:3},{value:"Working Code Examples",id:"working-code-examples",level:2},{value:"Example 1: ROS 2 Publisher and Subscriber (Python)",id:"example-1-ros-2-publisher-and-subscriber-python",level:3},{value:"Publisher (<code>my_publisher_node.py</code>)",id:"publisher-my_publisher_nodepy",level:4},{value:"Subscriber (<code>my_subscriber_node.py</code>)",id:"subscriber-my_subscriber_nodepy",level:4},{value:"Example 2: ROS 2 Service Client and Server (Python)",id:"example-2-ros-2-service-client-and-server-python",level:3},{value:"Server (<code>simple_add_server.py</code>)",id:"server-simple_add_serverpy",level:4},{value:"Client (<code>simple_add_client.py</code>)",id:"client-simple_add_clientpy",level:4},{value:"How to Run Examples",id:"how-to-run-examples",level:3},{value:"Exercises",id:"exercises",level:2},{value:"Summary",id:"summary",level:2}];function a(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,o.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"ros-2-nodes-topics-and-services",children:"ROS 2 Nodes, Topics, and Services"})}),"\n",(0,i.jsxs)(n.p,{children:["In ROS 2, the communication system is built around a decentralized architecture where individual processes, called ",(0,i.jsx)(n.strong,{children:"nodes"}),", interact with each other through various communication patterns. This modularity is a cornerstone of ROS, allowing for flexible and robust robot software development. This chapter will delve into the core communication mechanisms: Topics, Services, and Actions."]}),"\n",(0,i.jsx)(n.h2,{id:"concepts",children:"Concepts"}),"\n",(0,i.jsx)(n.h3,{id:"nodes",children:"Nodes"}),"\n",(0,i.jsxs)(n.p,{children:["A ",(0,i.jsx)(n.strong,{children:"Node"})," is an executable process that performs computations. In a ROS 2 system, a robot's capabilities are typically broken down into many small, specialized nodes. For example, one node might control the robot's motors, another might process camera data, and yet another might plan navigation paths. This modular approach enhances reusability, simplifies debugging, and allows for parallel development."]}),"\n",(0,i.jsx)(n.p,{children:"Each node in ROS 2 needs a unique name within the ROS graph to prevent conflicts and ensure proper routing of messages."}),"\n",(0,i.jsx)(n.h3,{id:"topics",children:"Topics"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Topics"})," are the most common method of asynchronous, many-to-many, publish-subscribe communication in ROS 2. Nodes publish messages to a named topic, and other nodes subscribe to that same topic to receive those messages. This is a one-way broadcast mechanism, where publishers don't know who their subscribers are, and subscribers don't know who their publishers are."]}),"\n",(0,i.jsx)(n.p,{children:"Key characteristics of Topics:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Asynchronous:"})," Publishers and subscribers operate independently."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Many-to-many:"})," Multiple publishers can send messages to a single topic, and multiple subscribers can receive messages from it."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Message Type:"})," Each topic has a defined message type (e.g., ",(0,i.jsx)(n.code,{children:"std_msgs/msg/String"}),", ",(0,i.jsx)(n.code,{children:"sensor_msgs/msg/LaserScan"}),"), ensuring data consistency."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Quality of Service (QoS):"})," ROS 2 allows configuring QoS policies for topics, enabling developers to fine-tune communication reliability, latency, and durability based on application requirements."]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"services",children:"Services"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Services"})," provide a synchronous, one-to-one, request-reply communication model. When a node (client) needs to request a specific operation from another node (server) and expects an immediate response, it uses a service. This is ideal for operations that are performed infrequently and require a direct result."]}),"\n",(0,i.jsx)(n.p,{children:"Key characteristics of Services:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Synchronous:"})," The client blocks until it receives a reply from the server."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"One-to-one:"})," A single client makes a request to a single server."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Request/Response Pair:"})," Services define a request message and a response message."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Deterministic:"})," Useful for deterministic operations where the client needs to know the outcome of its request immediately."]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"working-code-examples",children:"Working Code Examples"}),"\n",(0,i.jsx)(n.h3,{id:"example-1-ros-2-publisher-and-subscriber-python",children:"Example 1: ROS 2 Publisher and Subscriber (Python)"}),"\n",(0,i.jsx)(n.p,{children:"Building upon the previous introduction, here's a detailed example of a publisher and subscriber in Python."}),"\n",(0,i.jsxs)(n.h4,{id:"publisher-my_publisher_nodepy",children:["Publisher (",(0,i.jsx)(n.code,{children:"my_publisher_node.py"}),")"]}),"\n",(0,i.jsx)(n.p,{children:'This node publishes "Hello ROS 2!" messages with a counter.'}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"import rclpy\nfrom rclpy.node import Node\nfrom std_msgs.msg import String\n\nclass MyPublisher(Node):\n    def __init__(self):\n        super().__init__('my_publisher')\n        self.publisher_ = self.create_publisher(String, 'my_topic', 10)\n        self.timer = self.create_timer(0.5, self.timer_callback)\n        self.count = 0\n        self.get_logger().info('MyPublisher node has been started.')\n\n    def timer_callback(self):\n        msg = String()\n        msg.data = f'Hello ROS 2! This is message number: {self.count}'\n        self.publisher_.publish(msg)\n        self.get_logger().info(f'Published: \"{msg.data}\"')\n        self.count += 1\n\ndef main(args=None):\n    rclpy.init(args=args)\n    node = MyPublisher()\n    try:\n        rclpy.spin(node)\n    except KeyboardInterrupt:\n        node.get_logger().info('MyPublisher node stopped cleanly.')\n    finally:\n        node.destroy_node()\n        rclpy.shutdown()\n\nif __name__ == '__main__':\n    main()\n"})}),"\n",(0,i.jsxs)(n.h4,{id:"subscriber-my_subscriber_nodepy",children:["Subscriber (",(0,i.jsx)(n.code,{children:"my_subscriber_node.py"}),")"]}),"\n",(0,i.jsx)(n.p,{children:"This node subscribes to the topic and prints the received messages."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"import rclpy\nfrom rclpy.node import Node\nfrom std_msgs.msg import String\n\nclass MySubscriber(Node):\n    def __init__(self):\n        super().__init__('my_subscriber')\n        self.subscription = self.create_subscription(\n            String,\n            'my_topic',\n            self.listener_callback,\n            10)\n        self.get_logger().info('MySubscriber node has been started.')\n\n    def listener_callback(self, msg):\n        self.get_logger().info(f'I heard: \"{msg.data}\"')\n\ndef main(args=None):\n    rclpy.init(args=args)\n    node = MySubscriber()\n    try:\n        rclpy.spin(node)\n    except KeyboardInterrupt:\n        node.get_logger().info('MySubscriber node stopped cleanly.')\n    finally:\n        node.destroy_node()\n        rclpy.shutdown()\n\nif __name__ == '__main__':\n    main()\n"})}),"\n",(0,i.jsx)(n.h3,{id:"example-2-ros-2-service-client-and-server-python",children:"Example 2: ROS 2 Service Client and Server (Python)"}),"\n",(0,i.jsx)(n.p,{children:"This example demonstrates a service where a client requests a sum of two integers and a server provides the result."}),"\n",(0,i.jsxs)(n.h4,{id:"server-simple_add_serverpy",children:["Server (",(0,i.jsx)(n.code,{children:"simple_add_server.py"}),")"]}),"\n",(0,i.jsxs)(n.p,{children:["This node provides an ",(0,i.jsx)(n.code,{children:"add_two_ints"})," service."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"import rclpy\nfrom rclpy.node import Node\nfrom example_interfaces.srv import AddTwoInts # Standard ROS 2 service message\n\nclass AddTwoIntsService(Node):\n    def __init__(self):\n        super().__init__('add_two_ints_server')\n        self.srv = self.create_service(AddTwoInts, 'add_two_ints', self.add_two_ints_callback)\n        self.get_logger().info('AddTwoInts service server has been started.')\n\n    def add_two_ints_callback(self, request, response):\n        response.sum = request.a + request.b\n        self.get_logger().info(f'Incoming request: a={request.a}, b={request.b}. Sending back sum: {response.sum}')\n        return response\n\ndef main(args=None):\n    rclpy.init(args=args)\n    node = AddTwoIntsService()\n    try:\n        rclpy.spin(node)\n    except KeyboardInterrupt:\n        node.get_logger().info('AddTwoInts service server stopped cleanly.')\n    finally:\n        node.destroy_node()\n        rclpy.shutdown()\n\nif __name__ == '__main__':\n    main()\n"})}),"\n",(0,i.jsxs)(n.h4,{id:"client-simple_add_clientpy",children:["Client (",(0,i.jsx)(n.code,{children:"simple_add_client.py"}),")"]}),"\n",(0,i.jsxs)(n.p,{children:["This node requests the ",(0,i.jsx)(n.code,{children:"add_two_ints"})," service."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"import rclpy\nfrom rclpy.node import Node\nfrom example_interfaces.srv import AddTwoInts\nimport sys\n\nclass AddTwoIntsClient(Node):\n    def __init__(self):\n        super().__init__('add_two_ints_client')\n        self.client = self.create_client(AddTwoInts, 'add_two_ints')\n        while not self.client.wait_for_service(timeout_sec=1.0):\n            self.get_logger().info('Service not available, waiting again...')\n        self.request = AddTwoInts.Request()\n        self.get_logger().info('AddTwoInts service client has been started.')\n\n    def send_request(self, a, b):\n        self.request.a = a\n        self.request.b = b\n        self.future = self.client.call_async(self.request)\n        self.get_logger().info(f'Requesting sum of {a} and {b}...')\n\n\ndef main(args=None):\n    rclpy.init(args=args)\n    if len(sys.argv) != 3:\n        print('Usage: ros2 run <package_name> simple_add_client <int_a> <int_b>')\n        return\n\n    node = AddTwoIntsClient()\n    node.send_request(int(sys.argv[1]), int(sys.argv[2]))\n\n    while rclpy.ok():\n        rclpy.spin_once(node)\n        if node.future.done():\n            try:\n                response = node.future.result()\n            except Exception as e:\n                node.get_logger().error(f'Service call failed: {e}')\n            else:\n                node.get_logger().info(f'Result of add_two_ints: {response.sum}')\n            break\n    \n    node.destroy_node()\n    rclpy.shutdown()\n\nif __name__ == '__main__':\n    main()\n"})}),"\n",(0,i.jsx)(n.h3,{id:"how-to-run-examples",children:"How to Run Examples"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Create a ROS 2 Workspace and Python Package:"}),"\n(Same as in the previous chapter, ensure you have a workspace like ",(0,i.jsx)(n.code,{children:"ros2_ws/src/my_ros2_package"}),")."]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Place Code:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["For Publisher/Subscriber: Save ",(0,i.jsx)(n.code,{children:"my_publisher_node.py"})," and ",(0,i.jsx)(n.code,{children:"my_subscriber_node.py"})," in ",(0,i.jsx)(n.code,{children:"ros2_ws/src/my_ros2_package/my_ros2_package/"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:["For Service Client/Server: Save ",(0,i.jsx)(n.code,{children:"simple_add_server.py"})," and ",(0,i.jsx)(n.code,{children:"simple_add_client.py"})," in the same directory."]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsxs)(n.strong,{children:["Update ",(0,i.jsx)(n.code,{children:"setup.py"})," and ",(0,i.jsx)(n.code,{children:"package.xml"}),":"]})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["In ",(0,i.jsx)(n.code,{children:"ros2_ws/src/my_ros2_package/setup.py"}),", ensure all ",(0,i.jsx)(n.code,{children:"console_scripts"})," entry points are added:","\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"entry_points={\n    'console_scripts': [\n        'my_publisher = my_ros2_package.my_publisher_node:main',\n        'my_subscriber = my_ros2_package.my_subscriber_node:main',\n        'add_server = my_ros2_package.simple_add_server:main',\n        'add_client = my_ros2_package.simple_add_client:main',\n    ],\n},\n"})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["In ",(0,i.jsx)(n.code,{children:"ros2_ws/src/my_ros2_package/package.xml"}),", ensure ",(0,i.jsx)(n.code,{children:"rclpy"}),", ",(0,i.jsx)(n.code,{children:"std_msgs"}),", and ",(0,i.jsx)(n.code,{children:"example_interfaces"})," dependencies are listed:","\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-xml",children:"<exec_depend>rclpy</exec_depend>\n<exec_depend>std_msgs</exec_depend>\n<exec_depend>example_interfaces</exec_depend>\n"})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Build and Source the Workspace:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"cd ros2_ws\ncolcon build\nsource install/setup.bash\n"})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Run Publisher/Subscriber:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Terminal 1 (Publisher): ",(0,i.jsx)(n.code,{children:"ros2 run my_ros2_package my_publisher"})]}),"\n",(0,i.jsxs)(n.li,{children:["Terminal 2 (Subscriber): ",(0,i.jsx)(n.code,{children:"ros2 run my_ros2_package my_subscriber"})]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Run Service Client/Server:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Terminal 1 (Server): ",(0,i.jsx)(n.code,{children:"ros2 run my_ros2_package add_server"})]}),"\n",(0,i.jsxs)(n.li,{children:["Terminal 2 (Client): ",(0,i.jsx)(n.code,{children:"ros2 run my_ros2_package add_client 5 7"})," (This will request 5 + 7 from the server)"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"exercises",children:"Exercises"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Modify Topic Communication:"})," Change the message type of ",(0,i.jsx)(n.code,{children:"my_topic"})," to ",(0,i.jsx)(n.code,{children:"std_msgs/msg/Int32"}),". Update both the publisher and subscriber to handle integer messages."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Implement a Custom Message:"})," Define a custom ROS 2 message type (e.g., ",(0,i.jsx)(n.code,{children:"RobotPose"})," with ",(0,i.jsx)(n.code,{children:"x, y, z, roll, pitch, yaw"})," fields). Create a publisher and subscriber for this custom message."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Error Handling in Services:"})," Modify the ",(0,i.jsx)(n.code,{children:"add_two_ints_callback"})," in the server to intentionally raise an error under certain conditions (e.g., if ",(0,i.jsx)(n.code,{children:"request.a"})," is negative). Observe how the client handles this."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Asynchronous Service Client:"})," Research how to make a service client non-blocking, allowing it to perform other tasks while waiting for a service response."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Explore QoS Settings:"})," Experiment with different QoS profiles for your topic. For instance, set ",(0,i.jsx)(n.code,{children:"rclpy.qos.QoSProfile(depth=1)"})," and ",(0,i.jsx)(n.code,{children:"rclpy.qos.ReliabilityPolicy.RELIABLE"})," for the publisher and ",(0,i.jsx)(n.code,{children:"rclpy.qos.ReliabilityPolicy.BEST_EFFORT"})," for the subscriber. How does this affect message delivery?"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"summary",children:"Summary"}),"\n",(0,i.jsx)(n.p,{children:"This chapter provided a comprehensive overview of ROS 2's core communication patterns: Nodes, Topics, and Services. You've learned how to create and run publisher-subscriber systems for asynchronous data streaming and client-server setups for synchronous request-reply interactions. Through practical Python examples and engaging exercises, you've gained a solid foundation in building modular and communicative robot software components in ROS 2. This understanding is crucial for developing more complex robotic behaviors and integrating various functionalities."})]})}function h(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(a,{...e})}):a(e)}},8453:(e,n,s)=>{s.d(n,{R:()=>l,x:()=>c});var r=s(6540);const i={},o=r.createContext(i);function l(e){const n=r.useContext(o);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:l(e.components),r.createElement(o.Provider,{value:n},e.children)}}}]);